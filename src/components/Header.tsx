import * as React from "react";
import AppBar from "@mui/material/AppBar";
import Box from "@mui/material/Box";
import Toolbar from "@mui/material/Toolbar";
import Typography from "@mui/material/Typography";
import IconButton from "@mui/material/IconButton";
import MenuIcon from "@mui/icons-material/Menu";
import AccountCircle from "@mui/icons-material/AccountCircle";
import { useUser } from "../context/AuthContext";
import LocalFireDepartmentIcon from "@mui/icons-material/LocalFireDepartment";
import SvgIcon from "@mui/material/SvgIcon";
import { Button, Menu, MenuItem, Tooltip } from "@mui/material";
import { useRouter } from "next/router";
import { Auth } from "aws-amplify";
import AddIcon from "@mui/icons-material/Add";

export default function Header() {
  const { user } = useUser();
  const router = useRouter();
  const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null);

  const handleMenu = (event: React.MouseEvent<HTMLElement>) => {
    setAnchorEl(event.currentTarget);
  };

  const handleClose = () => {
    setAnchorEl(null);
  };

  const signUserOut = () => {
    Auth.signOut();
  };

  return (
    <Box sx={{ flexGrow: 1 }}>
      <AppBar position="static" color="inherit">
        <Toolbar>
          {/* <LocalFireDepartmentIcon sx={{ flexGrow: 1 }} /> */}
          <Box sx={{ flexGrow: 1, display: "flex", alignItems: "center" }}>
            <IconButton size="large" edge="start" color="inherit" aria-label="menu" sx={{ mr: 0 }}>
              <SvgIcon
                color="secondary"
                fontSize="large"
                sx={{ fontSize: "1.5em" }}
                viewBox="0 0 1200 1200"
              >
                <path d="m791.64 767.51c-14.832 2.457-31.875 5.0234-50.383 7.5 21.469-28.555 39.211-59.73 52.801-92.773 9.8438-21.168 20.008-43.125 32.457-65.383 42.148-75.695 52.293-140.21 30.168-191.77-19.418-41.059-55.66-71.699-99.375-84.02-0.24219 0-0.46875-0.11328-0.71094-0.20703l-0.84375-0.22656c-0.42969-0.11328-0.82422 0-1.2578 0v0.003906c-1.9219-0.41016-3.8945-0.51172-5.8516-0.30078-0.46875 0-0.88281 0.24219-1.332 0.33594h0.003906c-1.8867 0.34375-3.7109 0.97656-5.4023 1.875-0.52344 0.30078-0.91797 0.71094-1.4062 1.0508-1.2383 0.69531-2.3906 1.5391-3.4297 2.5117-0.28125 0.32031-0.375 0.75-0.65625 1.0859-0.28125 0.33594-0.50781 0.88281-0.80469 1.332h-0.003906c-1.0664 1.5391-1.8906 3.2344-2.4375 5.0273 0 0.20703-0.22656 0.35547-0.28125 0.58203-0.027344 0.49609-0.027344 1 0 1.5-0.30078 1.5859-0.39063 3.207-0.26172 4.8164 0.10938 0.9375 0.28516 1.8633 0.52734 2.7773 0.53906 2.3516 1.5742 4.5625 3.0352 6.4844 0.41406 0.5625 0.61719 1.2383 1.0859 1.7617 4.5938 5.1758 38.176 47.383-17.605 115.99-0.50781 0.62891-0.97266 1.293-1.3867 1.9883-9.375 15.301-20.363 24.133-26.477 21.262-14.25-6.375-29.887-55.07-3.3945-143.55 20.023-67.105 15.824-126.49-12.543-176.51-47.586-84-146.59-110.02-150.79-111.09h-0.41406c-6.2227-1.625-12.848 0.050781-17.547 4.4453-2.9844 2.8945-4.9023 6.7109-5.4453 10.832-0.54688 4.1211 0.31641 8.3047 2.4453 11.875 0.23828 0.42578 0.5 0.83984 0.78516 1.2383 0.46094 0.89063 0.99219 1.7422 1.5938 2.5469 0.78906 0.74219 1.6445 1.4141 2.5508 2.0078l0.13281 0.11328c0.20703 0.14844 0.375 0.35547 0.58203 0.48828 62.289 50.492 26.117 186.43-3.3359 261.43h-0.003906c-17.047-15.879-38.141-26.754-60.961-31.434-22.824-4.6797-46.492-2.9844-68.414 4.9023-4.418 1.5742-8.0859 4.7461-10.281 8.8945-2.1953 4.1445-2.7539 8.9648-1.5703 13.504 1.1875 4.5391 4.0312 8.4688 7.9688 11.016 66.992 43.273 48.938 93.75 28.125 152.14-6.7656 17.508-12.242 35.484-16.387 53.793-11.926 60.992-2.082 136.35 51.227 187.5-18-2.3984-34.762-4.9297-49.312-7.332-13.078-2.1992-26.473 1.2188-36.895 9.418-10.422 8.1992-16.902 20.414-17.84 33.641-0.94141 13.227 3.7461 26.234 12.902 35.824l144.71 152.12v103.99c0 6.6992 3.5742 12.887 9.375 16.238 5.8047 3.3477 12.949 3.3477 18.75 0 5.8047-3.3516 9.375-9.5391 9.375-16.238v-111.49c-0.007813-4.8047-1.8516-9.4258-5.1562-12.918l-149.87-157.5c-2.9844-2.918-3.6172-7.4805-1.5391-11.102 1.7773-3.7422 5.8828-5.7891 9.9375-4.9492 68.914 11.859 138.66 18.27 208.58 19.164 19.258 0 38.645-0.65625 57.695-1.7617h-0.003906c50.566-3.1836 100.94-8.9922 150.9-17.402 4.0547-0.81641 8.1484 1.2227 9.9375 4.9492 2.0781 3.6211 1.4453 8.1836-1.5391 11.102l-149.91 157.5c-3.3125 3.4844-5.1562 8.1094-5.1562 12.918v111.49c0 6.6992 3.5742 12.887 9.375 16.238 5.8008 3.3477 12.949 3.3477 18.75 0 5.8008-3.3516 9.375-9.5391 9.375-16.238v-103.99l144.7-152.12c9.1367-9.582 13.812-22.57 12.883-35.777-0.93359-13.207-7.3867-25.414-17.777-33.617-10.395-8.2031-23.762-11.648-36.824-9.4883zm-202.5 18.637c-9.375 0-18.637-0.16797-27.977-0.44922-12.133-0.39453-24.188-1.0703-36.148-1.875l-0.019531-0.074219c-97.5-30.656-117.3-117.68-103.31-189.19 3.7969-16.453 8.7734-32.613 14.887-48.355 17.512-48.957 40.5-113.23-8.8516-167.85h0.003906c13.922 0.47656 27.465 4.668 39.219 12.148 11.754 7.4766 21.293 17.965 27.625 30.379 1.5703 3.1016 4.0273 5.6719 7.0547 7.3828 3.0312 1.7109 6.5 2.4883 9.9688 2.2344 3.4453-0.11719 6.7969-1.1797 9.6758-3.0742 2.8828-1.8945 5.1836-4.5508 6.6562-7.668 3.957-8.3984 80.324-173.51 43.555-279.84 29.617 16.305 54.395 40.156 71.812 69.129 11.637 22.578 18.465 47.324 20.059 72.672 1.5898 25.352-2.0938 50.754-10.812 74.609-32.418 108.24-11.25 172.69 23.961 188.53 5.6875 2.4922 11.828 3.7695 18.039 3.75 14.738 0 35.344-7.1797 55.051-38.512 36.73-45.617 42.582-84.227 38.344-112.5h-0.003906c15.02 10.785 26.879 25.391 34.352 42.301 17.289 40.312 7.707 93.75-28.48 158.74-13.125 23.492-23.586 46.031-33.75 67.82-25.031 53.867-45 96.488-88.125 116.12-26.926 2.1719-55.051 3.5781-82.727 3.5781zm-101.83 69.992v0.003906c6.6992 0.30078 12.727 4.1523 15.816 10.105s2.7656 13.098-0.84375 18.75c-3.6094 5.6484-9.9609 8.9453-16.66 8.6445h-1.7266l-12.676-1.2188h0.003906c-6.668-0.67188-12.469-4.8438-15.223-10.953-2.75-6.1055-2.0352-13.219 1.875-18.656 3.9141-5.4375 10.43-8.375 17.098-7.7031zm165.96 40.48c-22.258 1.3516-43.836 2.0234-64.125 2.0234-16.875 0-33.957-0.46875-50.773-1.293l-0.003906 0.003907c-6.6953-0.33594-12.707-4.2188-15.77-10.188-3.0586-5.9688-2.6992-13.113 0.9375-18.75 3.6406-5.6328 10.012-8.8984 16.707-8.5625 36.93 1.793 73.93 1.5625 110.83-0.69141 4.9453-0.22656 9.7852 1.4883 13.484 4.7773 3.7031 3.2891 5.9727 7.8906 6.3359 12.828 0.30078 4.9609-1.3789 9.8398-4.6719 13.566-3.2969 3.7227-7.9336 5.9844-12.898 6.2891zm1.7422-143.18v0.003907c-4.0898 5.0312-10.488 7.5938-16.922 6.7734-6.4297-0.82031-11.984-4.9062-14.68-10.801-2.6953-5.8984-2.1523-12.77 1.4336-18.172 16.141-24.691 18.488-55.934 6.2266-82.762-2.7617 15.496-10.125 29.805-21.133 41.062-4.8164 5.4727-11 9.5703-17.918 11.875-6.9141 2.3047-14.32 2.7383-21.457 1.25-9.7188-2.5312-18.516-7.7734-25.367-15.113 2.6094 18.156 9.2344 35.5 19.387 50.773 3.0547 4.1406 4.2773 9.3516 3.375 14.418-0.89844 5.0625-3.8398 9.5391-8.1328 12.371s-9.5625 3.7773-14.574 2.6133c-5.0117-1.1641-9.3203-4.3398-11.926-8.7773-13.008-19.941-21.602-42.434-25.195-65.973-3.5977-23.539-2.1133-47.57 4.3477-70.488 1.3477-5.1914 4.8555-9.5586 9.6367-11.992 4.7812-2.4336 10.375-2.7031 15.371-0.74219 4.9922 1.9648 8.9023 5.9727 10.746 11.008 7.2734 19.82 21.805 43.406 30.355 45.262 0.91797 0.16797 3.1133-1.3867 4.8203-3.1133 24.242-24.227 5.4922-82.836-1.0859-93.113v0.003906c-4.4453-5.0234-5.8711-12.039-3.7461-18.398 2.1289-6.3633 7.4922-11.105 14.062-12.441 6.5742-1.3359 13.363 0.93359 17.809 5.957 4.4414 4.9141 110.04 119.53 44.625 208.52z" />
              </SvgIcon>
            </IconButton>
            <Typography
              onClick={() => router.push(`/`)}
              variant="h6"
              component="div"
              sx={{ display: "inline", marginLeft: 1, cursor: "pointer" }}
            >
              {`Teacher's Torch`}
            </Typography>
          </Box>

          {user && (
            <div>
              <Tooltip title="New Post">
                <IconButton
                  onClick={() => router.push("/post/new")}
                  color="primary"
                  aria-label="new post"
                  component="label"
                >
                  <AddIcon />
                </IconButton>
              </Tooltip>
              <IconButton
                size="large"
                aria-label="account of current user"
                aria-controls="menu-appbar"
                aria-haspopup="true"
                onClick={handleMenu}
                color="inherit"
              >
                <AccountCircle />
              </IconButton>
              <Menu
                id="menu-appbar"
                anchorEl={anchorEl}
                anchorOrigin={{
                  vertical: "top",
                  horizontal: "right",
                }}
                keepMounted
                transformOrigin={{
                  vertical: "top",
                  horizontal: "right",
                }}
                open={Boolean(anchorEl)}
                onClose={handleClose}
              >
                <MenuItem onClick={() => signUserOut()}>Sign Out</MenuItem>
              </Menu>
            </div>
          )}
          {!user && (
            <>
              <Button variant="outlined" onClick={() => router.push(`/login`)}>
                Log in
              </Button>
              <Button
                sx={{ marginLeft: 2 }}
                variant="contained"
                color="primary"
                onClick={() => router.push(`/signup`)}
              >
                Sign up
              </Button>
            </>
          )}
        </Toolbar>
      </AppBar>
    </Box>
  );
}
